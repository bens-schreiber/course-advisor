<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Course Advisor</title>
    <link href="styles.css" rel="stylesheet" />
    <script
      src="https://unpkg.com/htmx.org@2.0.4"
      integrity="sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+"
      crossorigin="anonymous"
    ></script>
    <script src="//unpkg.com/alpinejs" defer></script>
  </head>
  <body>
    <main>

      <div class="search-container" style="display: flex; gap: 2rem; justify-content: space-between;">
        <!-- First component: Course/Professor search -->
        <div class="search-component" style="flex: 1; min-width: 0;">
          <h3>Find Professors by Course</h3>
          <div x-data="{ 
            courses: [], 
            selectedCourse: null,
            searchText: '',
            topProfessors: []
          }" x-init="fetch('/api/v1/courses/search').then(r => r.json()).then(data => courses = data)">
            
            <!-- Course selection -->
            <input 
              list="course-list" 
              x-model="searchText"
              @change="selectedCourse = courses.find(c => c.name === searchText)"
              placeholder="Select a course"
            >
            
            <datalist id="course-list">
              <template x-for="course in courses" :key="course.id">
                <option :value="course.name"></option>
              </template>
            </datalist>
            
            <!-- Go button -->
            <button
              @click="if(selectedCourse) fetch(`/api/v1/top_professors?course_id=${selectedCourse.id}`).then(r => r.json()).then(data => topProfessors = data)"
              :disabled="!selectedCourse"
            >
              Go
            </button>
            
            <!-- Results section -->
            <div x-show="topProfessors.length > 0" class="professors-results">
              <h3>Top Professors for <span x-text="selectedCourse?.name"></span></h3>
              <ul>
                <template x-for="professor in topProfessors" :key="professor.id">
                  <li x-text="professor.name"></li>
                </template>
              </ul>
            </div>
            
            <!-- No results message -->
            <div x-show="selectedCourse && topProfessors.length === 0 && topProfessors.requested">
              No professors found for this course.
            </div>
          </div>
        </div>
    
        <!-- Second component: Class search -->
        <div class="search-component" style="flex: 1; min-width: 0;">
          <h3>Find Top Classes</h3>
          <div x-data="{ 
            departments: [], 
            ucores: [],
            credits: [1, 2, 3, 4],
            classLevels: [100, 200, 300, 400],
            selectedDepartment: null,
            selectedUcore: null,
            selectedCredits: null,
            selectedClassLevel: null,
            topClasses: [],
            searchPerformed: false
          }" x-init="
            Promise.all([
              fetch('/api/v1/departments').then(r => r.json()),
              fetch('/api/v1/ucores').then(r => r.json())
            ]).then(([deptData, ucoreData]) => {
              departments = deptData;
              ucores = ucoreData;
            })">
            
            <div class="search-form">
              <!-- Department Selection -->
              <div class="form-group">
                <label for="department-select">Department:</label>
                <select id="department-select" x-model="selectedDepartment">
                  <option value="">Select Department</option>
                  <template x-for="dept in departments" :key="dept.id">
                    <option :value="dept.id" x-text="dept.name"></option>
                  </template>
                </select>
              </div>
              
              <!-- Credits Selection -->
              <div class="form-group">
                <label for="credits-select">Credits:</label>
                <select id="credits-select" x-model="selectedCredits">
                  <option value="">Select Credits</option>
                  <template x-for="credit in credits" :key="credit">
                    <option :value="credit" x-text="credit"></option>
                  </template>
                </select>
              </div>
              
              <!-- Class Level Selection -->
              <div class="form-group">
                <label for="level-select">Class Level:</label>
                <select id="level-select" x-model="selectedClassLevel">
                  <option value="">Select Class Level</option>
                  <template x-for="level in classLevels" :key="level">
                    <option :value="level" x-text="level"></option>
                  </template>
                </select>
              </div>
              
              <!-- Ucore Selection (Optional) -->
              <div class="form-group">
                <label for="ucore-select">UCORE (Optional):</label>
                <select id="ucore-select" x-model="selectedUcore">
                  <option value="">Any UCORE</option>
                  <template x-for="ucore in ucores" :key="ucore.id">
                    <option :value="ucore.id" x-text="ucore.name"></option>
                  </template>
                </select>
              </div>
              
              <!-- Search Button -->
              <button
                @click="
                  let url = `/api/v1/top_classes?credits=${selectedCredits}&class_level=${selectedClassLevel}&department_id=${selectedDepartment}`;
                  if(selectedUcore) url += `&ucore=${selectedUcore}`;
                  
                  fetch(url)
                    .then(r => r.json())
                    .then(data => {
                      topClasses = data;
                      searchPerformed = true;
                    })
                "
                :disabled="!selectedDepartment || !selectedCredits || !selectedClassLevel">
                Search
              </button>
            </div>
            
            <!-- Results section - only show if search was performed -->
            <div x-show="searchPerformed && topClasses.length > 0" class="classes-results">
              <h3>Top Classes</h3>
              <ul>
                <template x-for="course in topClasses" :key="course.id">
                  <li>
                    <span x-text="course.code"></span>
                    <span x-text="course.name"></span>
                  </li>
                </template>
              </ul>
            </div>
            
            <!-- No results message - only show if search was performed -->
            <div x-show="searchPerformed && topClasses.length === 0">
              No classes found matching your criteria.
            </div>
          </div>
        </div>
      </div>

    </main>
    <footer></footer>
  </body>
</html>
